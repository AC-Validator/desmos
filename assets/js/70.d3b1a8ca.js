(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{417:function(e,s,t){"use strict";t.r(s);var a=t(42),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"upgrade-manager-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-manager-setup"}},[e._v("#")]),e._v(" Upgrade manager setup")]),e._v(" "),t("p",[e._v("The following guide allows you to setup your Desmos node along with the "),t("a",{attrs:{href:"https://github.com/regen-network/cosmosd",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("cosmosd")]),t("OutboundLink")],1),e._v(" binary to ensure that each time a new on-chain upgrade is required, it is handled properly.")]),e._v(" "),t("h2",{attrs:{id:"_1-setup-desmosd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-setup-desmosd"}},[e._v("#")]),e._v(" 1. Setup "),t("code",[e._v("desmosd")])]),e._v(" "),t("p",[e._v("If you haven't already, please setup the "),t("code",[e._v("desmosd")]),e._v(" binary and your validator node. You can do so by following these guides:")]),e._v(" "),t("ol",[t("li",[t("RouterLink",{attrs:{to:"/fullnode/setup.html"}},[e._v("Setup a full node")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/validators/setup.html"}},[e._v("Setup a validator node")])],1)]),e._v(" "),t("h2",{attrs:{id:"_2-setup-cosmosd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-setup-cosmosd"}},[e._v("#")]),e._v(" 2. Setup "),t("code",[e._v("cosmosd")])]),e._v(" "),t("h3",{attrs:{id:"installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),t("p",[e._v("In order to setup properly "),t("code",[e._v("cosmosd")]),e._v(" you are required to have Go 1.14+ installed on your machine. To make sure you have it, you can execute the following command, checking that the output matches the one provided:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ go version\ngo version go1.14.5 "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("os/build"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("Also, make sure you have "),t("code",[e._v("git")]),e._v(" installed as well:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" version\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" version "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.25")]),e._v(".1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("Now, we can start the installation process:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Create a folder for the "),t("code",[e._v("cosmosd")]),e._v(" source files:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" ~/cosmosd\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("Clone the "),t("code",[e._v("cosmosd")]),e._v(" sources inside that folder:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" ~/cosmosd \n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone git@github.com:regen-network/cosmosd.git "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" \n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("Build the "),t("code",[e._v("cosmosd")]),e._v(" binary and install it inside "),t("code",[e._v("$GOBIN")]),e._v(" to make it accessible everywhere:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("build -o "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$GOBIN")]),e._v("/cosmosd\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])])]),e._v(" "),t("p",[e._v("Now, you should be able to execute "),t("code",[e._v("cosmosd")]),e._v(" from everywhere. If everything has been done correctly, this should be the output:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ cosmosd\nDAEMON_NAME is not "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h3",{attrs:{id:"environment-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#environment-setup"}},[e._v("#")]),e._v(" Environment setup")]),e._v(" "),t("p",[e._v("Now, we need to properly setup the environmental variables for "),t("code",[e._v("cosmosd")]),e._v(". To do so, run:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'export DAEMON_NAME=desmosd'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" ~/.profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'export DAEMON_HOME="),t("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v("/.desmosd'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" ~/.profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'export DAEMON_RESTART_AFTER_UPGRADE=on'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" ~/.profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" 'export "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("DAEMON_ALLOW_DOWNLOAD_BINARIES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("on  "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" ~/.profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" ~/.profile\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("This will load the environmental variables into the "),t("code",[e._v("~/.profile")]),e._v(" file and then refresh the current terminal instance.")]),e._v(" "),t("p",[e._v("If you want to know more about the set variables, here is a brief description:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[e._v("Variable")]),e._v(" "),t("th",{staticStyle:{"text-align":"left"}},[e._v("Description")])])]),e._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("DAEMON_HOME")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[e._v("Location where upgrade binaries should be kept")])]),e._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("DAEMON_NAME")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[e._v("Name of the binary itself")])]),e._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("DAEMON_RESTART_AFTER_UPGRADE")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[e._v("(optional) if set to on it will restart a sub-process with the same args (but new binary) after a successful upgrade. By default, the manager dies afterwards and allows the supervisor to restart it if needed. Note that this will not auto-restart the child if there was an error.")])]),e._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("DAEMON_ALLOW_DOWNLOAD_BINARIES")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[e._v("(optional) if set to "),t("code",[e._v("on")]),e._v(" will enable auto-downloading of new binaries")])])])]),e._v(" "),t("h3",{attrs:{id:"folders-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#folders-setup"}},[e._v("#")]),e._v(" Folders setup")]),e._v(" "),t("p",[e._v("In order to work properly, the upgrade manager inside "),t("code",[e._v("cosmosd")]),e._v(" needs to have a specific folder structure in place:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("- genesis\n  - bin\n    - desmosd\n- upgrades\n  - <name>\n    - bin\n      - desmosd\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("In order to create it, please execute the following commands:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p ~/.desmosd/upgrade_manager/genesis/bin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p ~/.desmosd/upgrade_manager/upgrades\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("Now we need to copy the current "),t("code",[e._v("desmosd")]),e._v(" binary into the "),t("code",[e._v("genesis/bin")]),e._v(" folder to ensure that "),t("code",[e._v("cosmosd")]),e._v(" can start the chain properly:")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$GOBIN")]),e._v("/desmosd ~/.desmosd/upgrade_manager/genesis/bin\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);